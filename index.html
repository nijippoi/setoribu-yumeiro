<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="index.webmanifest" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
    <title>èŒãƒ‡ã‚£ã‚¹ã‚»ãƒˆãƒª</title>

    <style>
        #songs .song[data-song]::before {
            content: attr(data-song);
        }

        #setlist .song[data-song]::after {
            content: attr(data-song);
        }

        .song-move-up::before {
            content: "â–²";
        }

        .song-move-down::before {
            content: "â–¼";
        }

        .song-remove::before {
            content: "âœ–";
        }
    </style>
</head>

<body>
    <!-- âœ…âğŸ”²â˜â˜‘â˜’âœ”âŒ -->
    <section class="section">
        <div class="container">
            <div class="field" id="live-title">
                <div class="control">
                    <input class="input is-small" type="text" placeholder="ãƒ©ã‚¤ãƒ–å" />
                </div>
            </div>
            <div class="field" id="live-place">
                <div class="control">
                    <input class="input is-small" type="text" placeholder="ä¼šå ´" />
                </div>
            </div>
            <div class="field" id="live-date">
                <div class="control">
                    <input class="input is-small" type="date" placeholder="æ—¥ä»˜" data-start-date="10/24/2019">
                </div>
            </div>
            <div class="columns is-mobile">
                <div class="column is-half">
                    <article id="setlist" class="panel is-info">
                        <p class="panel-heading is-size-7">ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆ</p>
                    </article>
                    <div class="field has-addons" id="custom-song">
                        <div class="control is-expanded">
                            <input class="input is-small" type="text" placeholder="è‡ªç”±æ›¸ã" />
                        </div>
                        <div class="control">
                            <a id="custom-song-add" class="button is-small is-info">ï¼‹</a>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <article id="songs" class="panel is-info">
                        <p class="panel-heading is-size-7">æ›²</p>
                    </article>
                </div>
            </div>
            <div class="field" id="message">
                <div class="control">
                    <textarea class="textarea is-small" rows="10" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea>
                </div>
            </div>
            <div class="buttons">
                <button id="copy-button" class="button is-small is-primary">ã‚³ãƒ”ãƒ¼</button>
                <a id="tweet-button" class="button is-small is-info" href="#">ãƒ„ã‚¤ãƒ¼ãƒˆ</a>
                <button id="clear-button" class="button is-small is-danger is-outlined is-right">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
    </section>

    <script>
        const hashTags = ['èŒãƒ‡ã‚£ã‚¹', 'èŒç‡ƒãƒ‡ã‚£ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³', 'èŒãƒ‡ã‚£ã‚¹ã‚»ãƒˆãƒª'];
        const relatedAccounts = ['moe_destruction', 'nana_kumori', 'amina_minase', 'tenn_komiya', 'narua_ngo', 'renpha_hisaki'];
        const songs = ['SE', 'MC', '_Rebirth.', 'ã‚ãŸã—ã¯ã‚‚ã†ãã¿ã®ã˜ã‚ƒãªã„ã€‚', 'å›šã‚ã‚Œã‚«ã‚¿ã‚¹ãƒˆãƒ­ãƒ•ã‚£ãƒ¼', 'C.A.R', 'MU-ZE', 'NEVER STAY', '\'aimer', 'å½¼æ°ã‚­ãƒŸæ”»ç•¥æ³•', 'ã™ãŸãƒ¼ã¨ã‚ã£ã·â˜†ã—ããªã‚‹', 'æˆ¦äº‰çš„å¯æ„›ç—‡å€™ç¾¤', 'ä¸–ä»£äº¤ä»£ã€åé€†ã®ç‹¼ç…™', 'â˜†é…’ã‚¯ã‚ºãƒ•ã‚¡ãƒ¼ãƒ¼ãƒƒã‚¯â˜†', 'çµ¶å¯¾çµ¶å‘½é–‹ç¤ºè«‹æ±‚', 'Rebellion', 'HALU'];
        function addSong(song) {
            const setlistElem = document.getElementById('setlist');
            // <a class="panel-block setlist is-size-7" data-song="æ›²å">
            //     <span class="panel-icon song-move-up"></span>
            //     <span class="panel-icon song-move-down"></span>
            //     <span class="panel-icon song-remove"></span>
            // </a>
            const setlistSongElem = document.createElement('a');
            setlistSongElem.classList.add('panel-block', 'song', 'is-size-7');
            const moveUpElem = document.createElement('span');
            moveUpElem.classList.add('panel-icon', 'song-move-up');
            moveUpElem.addEventListener('click', (evt) => {
                console.log('ä¸Šã«ç§»å‹•', evt.target.parentNode.dataset.song);
                const thisSongElem = evt.target.parentNode;
                const parentElem = thisSongElem.parentNode;
                const prevSongElem = thisSongElem.previousElementSibling;
                if (prevSongElem && prevSongElem.classList.contains('song')) {
                    parentElem.insertBefore(thisSongElem, prevSongElem);
                }
                generateMessage();
            });
            const moveDownElem = document.createElement('span');
            moveDownElem.classList.add('panel-icon', 'song-move-down');
            moveDownElem.addEventListener('click', (evt) => {
                console.log('ä¸‹ã«ç§»å‹•', evt.target.parentNode.dataset.song);
                const thisSongElem = evt.target.parentNode;
                const parentElem = thisSongElem.parentNode;
                const nextSongElem = thisSongElem.nextElementSibling;
                if (nextSongElem && nextSongElem.classList.contains('song')) {
                    parentElem.insertBefore(nextSongElem, thisSongElem);
                }
                generateMessage();
            });
            const removeElem = document.createElement('span');
            removeElem.addEventListener('click', (evt) => {
                console.log('ã‚»ãƒˆãƒªã‹ã‚‰å‰Šé™¤', evt.target.parentNode.dataset.song);
                evt.target.parentNode.parentNode.removeChild(evt.target.parentNode);
                generateMessage();
            });
            removeElem.classList.add('panel-icon', 'song-remove');
            setlistSongElem.appendChild(moveUpElem);
            setlistSongElem.appendChild(moveDownElem);
            setlistSongElem.appendChild(removeElem);
            setlistSongElem.dataset.song = song;
            setlistElem.appendChild(setlistSongElem);
            generateMessage();
        }
        function renderSongs() {
            const songsElem = document.getElementById('songs');
            for (const song of songs) {
                // <a class="panel-block song is-size-7" data-song="æ›²å"></a>
                const songElem = document.createElement('a');
                songElem.classList.add('panel-block', 'song', 'is-size-7');
                songElem.dataset.song = song;
                songElem.addEventListener('click', (evt) => {
                    addSong(song);
                });
                songsElem.appendChild(songElem);
            }
        }
        function generateMessage() {
            // å…¥åŠ›å€¤ã‚’ä¿å­˜
            document.getElementById('live-title').getElementsByTagName('input').item(0).value ? localStorage.setItem('live-title', document.getElementById('live-title').getElementsByTagName('input').item(0).value) : localStorage.removeItem('live-title');
            document.getElementById('live-place').getElementsByTagName('input').item(0).value ? localStorage.setItem('live-place', document.getElementById('live-place').getElementsByTagName('input').item(0).value) : localStorage.removeItem('live-place');
            document.getElementById('live-date').getElementsByTagName('input').item(0).value ? localStorage.setItem('live-date', document.getElementById('live-date').getElementsByTagName('input').item(0).value) : localStorage.removeItem('live-date');
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
            const title = document.getElementById('live-title').getElementsByTagName('input').item(0).value;
            const place = document.getElementById('live-place').getElementsByTagName('input').item(0).value;
            const dateStr = document.getElementById('live-date').getElementsByTagName('input').item(0).value ? new Intl.DateTimeFormat('ja-JP').format(document.getElementById('live-date').getElementsByTagName('input').item(0).valueAsDate) : '';
            const setlist = [];
            for (const elem of document.querySelectorAll('#setlist .song')) {
                if (elem.dataset.song) {
                    setlist.push(elem.dataset.song);
                }
            }
            setlist && setlist.length > 0 ? localStorage.setItem('setlist', JSON.stringify(setlist)) : localStorage.removeItem('setlist');
            const setlistStr = Array.isArray(setlist) ? setlist.join('\n') : '';
            const hashTagsStr = hashTags.map(ht => '#' + ht).join('\n');
            const messageTweet = `${dateStr ? dateStr + '\n' : ''}${title ? title + '\n' : ''}${place ? '@ ' + place + '\n' : ''}${setlistStr ? '\n' + setlistStr + '\n\n' : ''}`;
            const messageTextarea = `${dateStr ? dateStr + '\n' : ''}${title ? title + '\n' : ''}${place ? '@ ' + place + '\n' : ''}${setlistStr ? '\n' + setlistStr + '\n' : ''}${hashTagsStr ? '\n' + hashTagsStr : ''}`;
            document.getElementById('message').getElementsByTagName('textarea').item(0).value = messageTextarea;
            const tweetButton = document.getElementById('tweet-button');
            tweetButton.href = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(messageTweet) + '&hashtags=' + encodeURIComponent(hashTags.join(',')) + '&related=' + encodeURIComponent(relatedAccounts.join(','));
        }
        function load() {
            // å…¥åŠ›å€¤ã‚’å¾©æ´»
            if (localStorage.getItem('live-title')) {
                document.getElementById('live-title').getElementsByTagName('input').item(0).value = localStorage.getItem('live-title');
            }
            if (localStorage.getItem('live-place')) {
                document.getElementById('live-place').getElementsByTagName('input').item(0).value = localStorage.getItem('live-place');
            }
            if (localStorage.getItem('live-date')) {
                document.getElementById('live-date').getElementsByTagName('input').item(0).value = localStorage.getItem('live-date');
            }
            if (localStorage.getItem('setlist')) {
                const setlist = JSON.parse(localStorage.getItem('setlist'));
                for (const song of setlist) {
                    addSong(song);
                }
            }
            // åˆæœŸåŒ–
            if (!document.getElementById('live-date').getElementsByTagName('input').item(0).value) {
                document.getElementById('live-date').getElementsByTagName('input').item(0).valueAsDate = new Date();
            }
            renderSongs();
            if (!document.querySelectorAll('#setlist .song') || document.querySelectorAll('#setlist .song').length < 1) {
                addSong('SE');
            }
            generateMessage();
            // ãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            document.getElementById('copy-button').addEventListener('click', (evt) => {
                document.querySelector('#message .textarea').select();
                document.execCommand('copy');
                window.alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
            document.getElementById('clear-button').addEventListener('click', (evt) => {
                document.getElementById('live-title').getElementsByTagName('input').item(0).value = null;
                document.getElementById('live-place').getElementsByTagName('input').item(0).value = null;
                document.getElementById('live-date').getElementsByTagName('input').item(0).valueAsDate = new Date();
                const setlistElem = document.getElementById('setlist');
                for (const songElem of setlistElem.querySelectorAll('.song')) {
                    setlistElem.removeChild(songElem);
                }
                addSong('SE');
                generateMessage();
            });
            document.getElementById('custom-song-add').addEventListener('click', (evt) => {
                const song = document.querySelector('#custom-song input').value;
                if (song) {
                    addSong(song);
                }
            });
            for (const elem of document.querySelectorAll('input')) {
                elem.addEventListener('change', (evt) => {
                    generateMessage();
                });
                elem.addEventListener('input', (evt) => {
                    generateMessage();
                });
            }
        }
        addEventListener('DOMContentLoaded', load);
    </script>
</body>

</html>